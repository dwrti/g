name: Gofile Custom Uploader

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'ุถุน ุฑุงุจุท ุงูููุทุน ููุง'
        required: true
      file_name:
        description: 'ุงูุชุจ ุงุณู ุงูููู'
        required: true

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: Download and Upload
        run: |
          # 1. ุชุฌููุฒ ุงูุงุณู (ุฅุฒุงูุฉ mp4 ูู ูุชุจุชูุง ูุฅุถุงูุชูุง ุจุดูู ุตุญูุญ)
          RAW_NAME=$(echo "${{ github.event.inputs.file_name }}" | sed 's/\.mp4//g')
          FINAL_FILE="${RAW_NAME}.mp4"

          echo "๐ ุฌุงุฑู ุชุญููู: $FINAL_FILE"

          # 2. ุงูุชุญููู ูู ุงูุฑุงุจุท
          curl -L "${{ github.event.inputs.video_url }}" -o "$FINAL_FILE"

          # ุชุฃูุฏ ุฃู ุงูููู ูุฒู ูุนููุงู ูุญุฌูู ุฃูุจุฑ ูู ุตูุฑ
          if [ ! -s "$FINAL_FILE" ]; then
            echo "โ ูุดู ุงูุชุญููู: ุงูุฑุงุจุท ูุฏ ูููู ุงูุชูู ุฃู ุบูุฑ ุตุงูุญ"
            exit 1
          fi

          # 3. ุฌูุจ ุงูุณูุฑูุฑ ูุน ูุญุงููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
          SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server' || echo "store1")
          
          echo "๐ค ุฌุงุฑู ุงูุฑูุน ุฅูู ุณูุฑูุฑ: $SERVER"

          # 4. ุงูุฑูุน ูุน ุญูุธ ุงููุชูุฌุฉ ูู ููู ููุชุฃูุฏ
          curl -F "file=@$FINAL_FILE" "https://${SERVER}.gofile.io/uploadFile" > response.json
          
          # 5. ุงูุชุญูู ูู ุงููุชูุฌุฉ ูุนุฑุถ ุงูุฑุงุจุท
          if grep -q "status\":\"ok\"" response.json; then
            echo "--------------------------------------------------"
            echo "โ ุชู ุงูุฑูุน ุจูุฌุงุญ ูุง ุจุทู!"
            echo "๐ ุงูุฑุงุจุท: $(jq -r '.data.downloadPage' response.json)"
            echo "--------------------------------------------------"
          else
            echo "โ ูุดู ุงูุฑูุน ุฅูู Gofile. ุงูุฑุฏ ูุงู:"
            cat response.json
            exit 1
          fi
