name: Gofile Custom Uploader

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø·Ø¹ Ù‡Ù†Ø§'
        required: true
      file_name:
        description: 'Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù'
        required: true

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: Download and Upload
        run: |
          # 1. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø§Ø³Ù…
          RAW_NAME=$(echo "${{ github.event.inputs.file_name }}" | sed 's/\.mp4//g')
          FINAL_FILE="${RAW_NAME}.mp4"

          # 2. Ø§Ù„ØªØ­Ù…ÙŠÙ„
          echo "ğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø·Ø¹..."
          curl -L "${{ github.event.inputs.video_url }}" -o "$FINAL_FILE"

          # 3. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹ (3 Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ù„Ù‰ Ø³ÙŠØ±ÙØ±Ø§Øª Ù…Ø®ØªÙ„ÙØ©)
          success=false
          for i in {1..3}; do
            echo "ğŸ“¤ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±ÙØ¹ Ø±Ù‚Ù… $i..."
            
            # Ø¬Ù„Ø¨ Ø³ÙŠØ±ÙØ± Ø¬Ø¯ÙŠØ¯ ÙÙŠ ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø©
            SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server')
            echo "ğŸ“¡ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø®ØªØ§Ø±: $SERVER"

            # Ø§Ù„Ø±ÙØ¹
            curl -F "file=@$FINAL_FILE" "https://${SERVER}.gofile.io/uploadFile" > response.json
            
            if grep -q "status\":\"ok\"" response.json; then
              echo "--------------------------------------------------"
              echo "âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø±Ù‚Ù… $i"
              echo "ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: $(jq -r '.data.downloadPage' response.json)"
              echo "--------------------------------------------------"
              success=true
              break
            else
              echo "âš ï¸ Ø§Ù„Ø³ÙŠØ±ÙØ± $SERVER Ù…Ù…ØªÙ„Ø¦ Ø£Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø³Ø£Ø­Ø§ÙˆÙ„ Ø³ÙŠØ±ÙØ± Ø¢Ø®Ø±..."
              sleep 2
            fi
          done

          if [ "$success" = false ]; then
            echo "âŒ Ù„Ù„Ø£Ø³Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ´Ù„Øª Ø¨Ø³Ø¨Ø¨ Ø¶ØºØ· Ø³ÙŠØ±ÙØ±Ø§Øª Gofile."
            cat response.json
            exit 1
          fi
