name: Video Uploader (Gofile & Catbox)

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'ุถุน ุฑุงุจุท ุงูููุทุน ููุง'
        required: true
      file_name:
        description: 'ุงูุชุจ ุงุณู ุงูููู'
        required: true

jobs:
  upload_job:
    runs-on: ubuntu-latest
    steps:
      - name: Download and Upload
        run: |
          # 1. ุชุฌููุฒ ุงูุงุณู
          RAW_NAME=$(echo "${{ github.event.inputs.file_name }}" | sed 's/\.mp4//g')
          FINAL_FILE="${RAW_NAME}.mp4"

          # 2. ุงูุชุญููู
          echo "๐ ุฌุงุฑู ุชุญููู ุงูููุทุน..."
          curl -L "${{ github.event.inputs.video_url }}" -o "$FINAL_FILE"

          # 3. ูุญุงููุฉ ุงูุฑูุน ุนูู Gofile ุฃููุงู
          echo "๐ค ูุญุงููุฉ ุงูุฑูุน ุนูู Gofile..."
          SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server' || echo "store1")
          curl -F "file=@$FINAL_FILE" "https://${SERVER}.gofile.io/uploadFile" > gofile_res.json
          
          if grep -q "status\":\"ok\"" gofile_res.json; then
            echo "--------------------------------------------------"
            echo "โ ุชู ุงูุฑูุน ุนูู Gofile ุจูุฌุงุญ!"
            echo "๐ ุงูุฑุงุจุท: $(jq -r '.data.downloadPage' gofile_res.json)"
            echo "--------------------------------------------------"
          else
            echo "โ๏ธ ูุดู Gofile (ุณูุฑูุฑ ููุชูุฆ)ุ ุฌุงุฑู ุงูุฑูุน ุนูู Catbox ูุจุฏูู..."
            
            # 4. ุงูุฑูุน ุนูู Catbox (ุงูุฎุทุฉ ุจ)
            CATBOX_URL=$(curl -F "reqtype=fileupload" -F "fileToUpload=@$FINAL_FILE" https://catbox.moe/user/api.php)
            
            if [[ $CATBOX_URL == http* ]]; then
              echo "--------------------------------------------------"
              echo "โ ุชู ุงูุฑูุน ุนูู Catbox ุจูุฌุงุญ!"
              echo "๐ ุงูุฑุงุจุท ุงููุจุงุดุฑ: $CATBOX_URL"
              echo "โน๏ธ ููุงุญุธุฉ: ูุฐุง ุฑุงุจุท ูุจุงุดุฑ ูููุดุงูุฏุฉ ูุงูุชุญููู"
              echo "--------------------------------------------------"
            else
              echo "โ ููุฃุณู ุฌููุน ุงูููุงูุน ุชุนุฐุฑุช ุญุงููุงู."
              exit 1
            fi
          fi
